const pg = require('utils/pg')

module.exports = async function getWebstoreSaleTotal ({ sale_id }, pgClient = null) {
  const db = pgClient === null ? pg : pgClient

  const { rows: [ { total } ] } = await db.query(`
    SELECT sale_id, total
    FROM webstore.sale
    WHERE sale_id = $1
  `, [ sale_id ])

  return total
}

// Sample total calculation query. This should happend automatically.

// SELECT SUM(webstore.sale_listing.quantity
//   * webstore.listing_product.quantity
//   * webstore.listing_product.price) AS total
// FROM webstore.sale_listing
// LEFT JOIN webstore.listing_product ON webstore.sale_listing.listing_id = webstore.listing_product.listing_id
// WHERE webstore.sale_listing.sale_id = $1