(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d2253a6"],{e401:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("q-table",{attrs:{flat:"",title:e.client?"Compras: "+e.client.name:"Compras",data:e.table.data,columns:e.table.columns,"row-key":"purchase_id",pagination:e.table.pagination,filter:e.table.filter,loading:e.table.loading},on:{"update:pagination":function(t){return e.$set(e.table,"pagination",t)},request:e.loadPurchases},scopedSlots:e._u([{key:"top-right",fn:function(){return[n("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{attrs:{name:"mdi-magnify"}})]},proxy:!0}]),model:{value:e.table.filter,callback:function(t){e.$set(e.table,"filter",t)},expression:"table.filter"}})]},proxy:!0},{key:"body-cell-invoices",fn:function(t){return[n("q-td",{attrs:{props:t,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:t.row.invoices_aggregate.aggregate.count+" Factura"+(t.row.invoices_aggregate.aggregate.count>1?"s":""),"icon-right":"mdi-open-in-new"},on:{click:function(n){return e.$router.push("/purchase/"+t.row.purchase_id+"/invoices")}}}),n("q-tooltip",[e._v("\n          Ver Facturas\n        ")])],1)]}},{key:"body-cell-purchased_products",fn:function(t){return[n("q-td",{attrs:{props:t,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:t.row.purchased_products.aggregate.count+" Producto"+(t.row.purchased_products.aggregate.count>1?"s":"")+" ("+t.row.used_purchased_products.aggregate.count+"/"+t.row.unused_purchased_products.aggregate.count+")","icon-right":"mdi-open-in-new"},on:{click:function(n){return e.$router.push("/purchase/"+t.row.purchase_id+"/purchasedproducts")}}}),n("q-tooltip",[e._v("\n          Ver "+e._s(t.row.purchased_products.aggregate.count)+" Producto"+e._s(t.row.purchased_products.aggregate.count>1?"s":"")+"\n          ("+e._s(t.row.used_purchased_products.aggregate.count)+" utilizados / "+e._s(t.row.unused_purchased_products.aggregate.count)+" no utilizados)\n        ")])],1)]}},{key:"body-cell-details",fn:function(t){return[n("q-td",{attrs:{props:t,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:"Detalles","icon-right":"mdi-open-in-new"},on:{click:function(n){return e.$router.push("/purchase/"+t.row.purchase_id)}}}),n("q-tooltip",[e._v("\n          Ver detalles de compra\n        ")])],1)]}}])}),n("q-inner-loading",{attrs:{showing:e.loading}},[n("q-spinner")],1)],1)},r=[],i=n("967e"),o=n.n(i),s=n("02fa"),c=n.n(s),u=(n("96cf"),n("fa84")),l=n.n(u),d=(n("c5f6"),n("7f7f"),n("bd4c")),p=d["b"].formatDate,g={name:"Purchases",props:{clientId:{type:String,required:!1}},data:function(){return{loading:!1,client:null,table:{loading:!1,data:[],columns:[{name:"created_at",label:"Fecha Hora",align:"left",field:"created_at",format:function(e,t){return p(e,"YYYY/MM/DD HH:mm")}},{name:"client_name",label:"Cliente",align:"left",field:function(e){return e.client.name},format:function(e,t){return e}},{name:"payment_status",label:"Estado Pago",align:"left",field:function(e){return e.payment.status},format:function(e,t){return e}},{name:"payment_amount",label:"Monto Pago",align:"left",field:function(e){return e.payment.amount},format:function(e,t){return"Bs ".concat((Number(e)/100).toFixed(2))}},{name:"invoices",label:"Facturas",align:"left",field:function(e){return e.invoices_aggregate.aggregate.count},format:function(e,t){return e}},{name:"purchased_products",label:"Productos Comprados",align:"left",field:function(e){return e.purchased_products.aggregate.count},format:function(e,t){return e}},{name:"details",label:"Ver detalles"}],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:10,rowsNumber:0},filter:""}}},methods:{loadPurchases:function(){var e=l()(o.a.mark(function e(){var t,n,a,r,i,s,u,l,d,p=arguments;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},n=t.pagination,a=t.filter,r=void 0===a?"":a,n||(n=this.table.pagination),i="query ($where: store_purchase_bool_exp! $offset: Int! $limit: Int! $order_by: [store_purchase_order_by!]) {\n        meta: store_purchase_aggregate (where: $where) {\n          rows: aggregate {\n            count\n          }\n        }\n        data: store_purchase (where: $where offset: $offset limit: $limit order_by: $order_by) {\n          purchase_id\n          created_at\n          client {\n            client_id\n            name\n          }\n          payment {\n            status\n            amount\n            updated_at\n          }\n          invoices_aggregate {\n            aggregate {\n              count\n            }\n          }\n          purchased_products: purchased_products_aggregate {\n            aggregate {\n              count\n            }\n          }\n          used_purchased_products: purchased_products_aggregate (where: {\n            purchased_product_uses: {\n              cancelled: {\n                _eq: false\n              }\n            }\n          }) {\n            aggregate {\n              count\n            }\n          }\n          unused_purchased_products: purchased_products_aggregate (where: {\n            _not: {\n              purchased_product_uses: {\n                cancelled: {\n                  _eq: false\n                }\n              }\n            }\n          }) {\n            aggregate {\n              count\n            }\n          }\n        }\n      }",s={limit:n.rowsPerPage,offset:n.rowsPerPage*(n.page-1),order_by:[{created_at:"desc"}],where:{client_id:this.clientId?{_eq:this.clientId}:null,_or:r?[{client:{name:{_ilike:"%".concat(r,"%")}}},{purchase_listings:{listing:{public_name:{_ilike:"%".concat(r,"%")}}}},{purchase_listings:{listing:{description:{_ilike:"%".concat(r,"%")}}}},{purchase_listings:{listing:{listing_products:{product:{public_name:{_ilike:"%".concat(r,"%")}}}}}},{purchase_listings:{listing:{listing_products:{product:{description:{_ilike:"%".concat(r,"%")}}}}}}]:[{}]}},e.prev=4,this.table.loading=!0,e.next=8,this.$gql(i,s,{role:"administrator"});case 8:u=e.sent,l=u.data,d=u.meta.rows.count,this.table.pagination=c()({},n,{rowsNumber:d}),this.table.data=l,e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](4),this.$gql.handleError(e.t0);case 18:return e.prev=18,this.table.loading=!1,e.finish(18);case 21:case"end":return e.stop()}},e,this,[[4,15,18,21]])}));function t(){return e.apply(this,arguments)}return t}(),loadClient:function(){var e=l()(o.a.mark(function e(){var t,n,a,r;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.clientId){e.next=2;break}return e.abrupt("return");case 2:return t="query ($client_id: uuid!) {\n        client: store_client_by_pk (client_id: $client_id) {\n          client_id\n          name\n        }\n      }",n={client_id:this.clientId},e.prev=4,this.loading=!0,e.next=8,this.$gql(t,n,{role:"administrator"});case 8:a=e.sent,r=a.client,this.client=r,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](4),this.$gql.handleError(e.t0);case 16:return e.prev=16,this.loading=!1,e.finish(16);case 19:case"end":return e.stop()}},e,this,[[4,13,16,19]])}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.loadClient(),this.loadPurchases()}},_=g,h=n("2877"),f=Object(h["a"])(_,a,r,!1,null,null,null);t["default"]=f.exports}}]);