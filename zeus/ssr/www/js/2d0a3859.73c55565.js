(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0a3859"],{"0311":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{attrs:{padding:""}},[n("q-table",{attrs:{flat:"",title:t.client?"Productos comprados: "+t.client.name:"Productos Comprados",data:t.table.data,columns:t.table.columns,"row-key":"purchased_product_id",pagination:t.table.pagination,filter:t.table.filter,loading:t.table.loading},on:{"update:pagination":function(e){return t.$set(t.table,"pagination",e)},request:t.loadPurchasedProducts},scopedSlots:t._u([{key:"top-right",fn:function(){return[n("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:t._u([{key:"append",fn:function(){return[n("q-icon",{attrs:{name:"mdi-magnify"}})]},proxy:!0}]),model:{value:t.table.filter,callback:function(e){t.$set(t.table,"filter",e)},expression:"table.filter"}})]},proxy:!0},{key:"body-cell-client",fn:function(e){return[n("q-td",{attrs:{props:e,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:e.row.client.name,"icon-right":"mdi-open-in-new"},on:{click:function(n){return t.$router.push("/client/"+e.row.client.client_id)}}}),n("q-tooltip",[t._v("\n          Ver detalles de cliente\n        ")])],1)]}},{key:"body-cell-product",fn:function(e){return[n("q-td",{attrs:{props:e,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:e.row.product.public_name,"icon-right":"mdi-open-in-new"},on:{click:function(n){return t.$router.push("/product/"+e.row.product.product_id)}}}),n("q-tooltip",[t._v("\n          Ver detalles de producto\n        ")])],1)]}},{key:"body-cell-listing",fn:function(e){return[n("q-td",{attrs:{props:e,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:e.row.listing.public_name,"icon-right":"mdi-open-in-new"},on:{click:function(n){return t.$router.push("/listing/"+e.row.listing.listing_id)}}}),n("q-tooltip",[t._v("\n          Ver detalles de paquete\n        ")])],1)]}},{key:"body-cell-purchase",fn:function(e){return[n("q-td",{attrs:{props:e,"auto-width":""}},[n("q-btn",{attrs:{"no-wrap":"",flat:"",size:"sm",label:"Compra","icon-right":"mdi-open-in-new"},on:{click:function(n){return t.$router.push("/purchase/"+e.row.purchase_id)}}}),n("q-tooltip",[t._v("\n          Ver detalles de compra\n        ")])],1)]}}])}),n("pre",[t._v(t._s(t.table.data))]),n("q-inner-loading",{attrs:{showing:t.loading}},[n("q-spinner")],1)],1)},r=[],a=n("967e"),o=n.n(a),l=n("02fa"),s=n.n(l),c=(n("96cf"),n("fa84")),u=n.n(c),d={name:"PurchasedProducts",props:{clientId:{type:String,required:!1},purchaseId:{type:String,required:!1}},data:function(){return{loading:!1,client:null,table:{loading:!1,data:[],columns:[{name:"client",label:"Cliente",align:"left"},{name:"product",label:"Producto",align:"left"},{name:"listing",label:"Paquete",align:"left"},{name:"purchase",label:"Compra"}],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:10,rowsNumber:0},filter:""}}},methods:{loadPurchasedProducts:function(){var t=u()(o.a.mark(function t(){var e,n,i,r,a,l,c,u,d,p=arguments;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=p.length>0&&void 0!==p[0]?p[0]:{},n=e.pagination,i=e.filter,r=void 0===i?"":i,n||(n=this.table.pagination),a="query ($where: store_purchased_product_bool_exp! $offset: Int! $limit: Int! $order_by: [store_purchased_product_order_by!]) {\n        meta: store_purchased_product_aggregate (where: $where) {\n          rows: aggregate {\n            count\n          }\n        }\n        data: store_purchased_product (where: $where offset: $offset limit: $limit order_by: $order_by) {\n          purchase_id\n          created_at\n          client {\n            client_id\n            name\n          }\n          product {\n            product_id\n            public_name\n          }\n          listing {\n            listing_id\n            public_name\n          }\n          purchase {\n            purchase_id\n          }\n        }\n      }",l={limit:n.rowsPerPage,offset:n.rowsPerPage*(n.page-1),order_by:[{created_at:"desc"}],where:{client_id:this.clientId?{_eq:this.clientId}:null,_or:r?[{client:{name:{_ilike:"%".concat(r,"%")}}},{purchase:{purchase_listings:{listing:{public_name:{_ilike:"%".concat(r,"%")}}}}},{purchase:{purchase_listings:{listing:{description:{_ilike:"%".concat(r,"%")}}}}},{purchase:{purchase_listings:{listing:{listing_products:{product:{public_name:{_ilike:"%".concat(r,"%")}}}}}}},{purchase:{purchase_listings:{listing:{listing_products:{product:{description:{_ilike:"%".concat(r,"%")}}}}}}}]:[{}]}},t.prev=4,this.table.loading=!0,t.next=8,this.$gql(a,l,{role:"administrator"});case 8:c=t.sent,u=c.data,d=c.meta.rows.count,this.table.pagination=s()({},n,{rowsNumber:d}),this.table.data=u,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](4),this.$gql.handleError(t.t0);case 18:return t.prev=18,this.table.loading=!1,t.finish(18);case 21:case"end":return t.stop()}},t,this,[[4,15,18,21]])}));function e(){return t.apply(this,arguments)}return e}(),loadClient:function(){var t=u()(o.a.mark(function t(){var e,n,i,r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.clientId){t.next=2;break}return t.abrupt("return");case 2:return e="query ($client_id: uuid!) {\n        client: store_client_by_pk (client_id: $client_id) {\n          client_id\n          name\n        }\n      }",n={client_id:this.clientId},t.prev=4,this.loading=!0,t.next=8,this.$gql(e,n,{role:"administrator"});case 8:i=t.sent,r=i.client,this.client=r,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](4),this.$gql.handleError(t.t0);case 16:return t.prev=16,this.loading=!1,t.finish(16);case 19:case"end":return t.stop()}},t,this,[[4,13,16,19]])}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.loadClient(),this.loadPurchasedProducts()}},p=d,h=n("2877"),_=Object(h["a"])(p,i,r,!1,null,null,null);e["default"]=_.exports}}]);