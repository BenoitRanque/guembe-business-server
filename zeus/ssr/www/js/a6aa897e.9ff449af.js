(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["a6aa897e"],{"4e53":function(t,i,e){var n=e("e916");"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var s=e("499e").default;s("0d7b84c8",n,!1,{sourceMap:!1})},"5fa6":function(t,i,e){"use strict";var n=e("4e53"),s=e.n(n);s.a},"74e1":function(t,i,e){"use strict";e.r(i);var n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("q-page",[e("q-btn",{on:{click:function(i){t.showCreateListingDialog=!0}}},[t._v("\n    Crear paquete nuevo\n  ")]),e("q-list",t._l(t.listings,function(i,n){return e("q-item",{key:n,attrs:{clickable:"",to:"/listing/"+i.listing_id}},[e("q-item-section",[e("q-item-label",{attrs:{lines:1}},[t._v("\n          "+t._s(i.public_name)+"\n        ")]),e("q-item-label",{attrs:{caption:"",lines:2}},[t._v("\n          "+t._s(i.description)+"\n        ")])],1)],1)}),1),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner")],1),e("dialog-window",{attrs:{title:"Crear Paquete"},model:{value:t.showCreateListingDialog,callback:function(i){t.showCreateListingDialog=i},expression:"showCreateListingDialog"}},[e("create-listing")],1)],1)},s=[],a=e("967e"),l=e.n(a),o=(e("96cf"),e("fa84")),r=e.n(o),d=e("7eb4"),u=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("q-form",{staticClass:"q-gutter-y-md",staticStyle:{width:"640px"},on:{submit:t.submit,reset:t.reset}},[e("div",{staticClass:"text-subtitle2 row q-px-md q-pt-sm"},[t._v("\n    Creacion de paquete\n    "),e("q-space"),t._v("\n    Bs "+t._s(t.listing.listing_products.reduce(function(i,e){var n=e.price,s=e.quantity;return i+t.getPriceAsNumber(n)/100*s},0).toFixed(2))+"\n  ")],1),e("q-input",{attrs:{filled:"",label:"Nombre Privado",hint:"Nombre de uso interno",required:"","lazy-rules":"",rules:[]},model:{value:t.listing.name,callback:function(i){t.$set(t.listing,"name",i)},expression:"listing.name"}}),e("q-input",{attrs:{filled:"",label:"Inicio del tiempo de disponibilidad",hint:"El paquete estara disponible para compra a partir de esta fecha",required:"","lazy-rules":"",mask:"date",rules:[function(t){return!!/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t)||"Formato invalido"}]},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-calendar"}},[e("q-popup-proxy",[e("q-date",{attrs:{"today-btn":""},model:{value:t.listing.available_from,callback:function(i){t.$set(t.listing,"available_from",i)},expression:"listing.available_from"}})],1)],1)]},proxy:!0}]),model:{value:t.listing.available_from,callback:function(i){t.$set(t.listing,"available_from",i)},expression:"listing.available_from"}}),e("q-input",{attrs:{filled:"",label:"Fin del tiempo de disponibilidad",hint:"El paquete esta disponible hasta esta fecha","lazy-rules":"",required:"",mask:"date",rules:[function(t){return!!/^-?[\d]+\/[0-1]\d\/[0-3]\d$/.test(t)||"Formato invalido"},function(i){return null!==t.listing.available_to&&new Date(i)>=new Date(t.listing.available_from)||"Fin de tiempo de disponibilidad debe ser igual o mayor a inicio de tiempo de disponibilidad"}]},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"mdi-calendar"}},[e("q-popup-proxy",[e("q-date",{attrs:{"today-btn":""},model:{value:t.listing.available_to,callback:function(i){t.$set(t.listing,"available_to",i)},expression:"listing.available_to"}})],1)],1)]},proxy:!0}]),model:{value:t.listing.available_to,callback:function(i){t.$set(t.listing,"available_to",i)},expression:"listing.available_to"}}),e("q-input",{attrs:{filled:"",type:"number",clearable:"",label:"Stock disponible",hint:"Cantidad maxima de este paquete que podra ser vendida (opcional)","lazy-rules":"",rules:[function(t){return null===t||""===t||Number(t)>0||"Stock disponible deber ser nulo o mayor que 0"}]},model:{value:t.listing.supply,callback:function(i){t.$set(t.listing,"supply",i)},expression:"listing.supply"}}),e("q-markup-table",{staticStyle:{"table-layout":"fixed"},attrs:{flat:"",dense:""}},[e("thead",[e("tr",[e("th",{staticClass:"text-left",staticStyle:{width:"30%"}},[t._v("Producto")]),e("th",{staticClass:"text-left",staticStyle:{width:"20%"}},[t._v("Precio (unitario)")]),e("th",{staticClass:"text-left",staticStyle:{width:"20%"}},[t._v("Cantidad")]),e("th",{staticClass:"text-left",staticStyle:{width:"30%"}},[t._v("Tiempo de vida")]),e("th",{staticStyle:{width:"auto"}})])]),e("tbody",[t._l(t.listing.listing_products,function(i,n){return e("tr",{key:n},[e("td",[e("q-select",{attrs:{dense:"",filled:"",options:t.options.product,"hide-bottom-space":"",required:"","lazy-rules":"",rules:[]},model:{value:i.product,callback:function(e){t.$set(i,"product",e)},expression:"item.product"}})],1),e("td",[e("q-input",{attrs:{type:"number",step:"0.01",min:"0","hide-bottom-space":"","lazy-rules":"",required:"",rules:[function(t){return!!t||"Campo Requerido"},function(t){return!!/^\d+\.?\d?\d?$/.test(t)||"Valor Invalido"}],dense:"",filled:""},model:{value:i.price,callback:function(e){t.$set(i,"price",e)},expression:"item.price"}})],1),e("td",[e("q-input",{attrs:{type:"number",min:"1",required:"","lazy-rules":"","hide-bottom-space":"",rules:[],dense:"",filled:""},model:{value:i.quantity,callback:function(e){t.$set(i,"quantity",e)},expression:"item.quantity"}})],1),e("td",[e("q-select",{attrs:{options:t.options.lifetime,"lazy-rules":"",required:"","hide-bottom-space":"",rules:[],dense:"",filled:""},model:{value:i.lifetime,callback:function(e){t.$set(i,"lifetime",e)},expression:"item.lifetime"}})],1),e("td",{staticClass:"text-right"},[e("q-btn",{attrs:{icon:"mdi-delete-outline",color:"negative",flat:"",dense:""},on:{click:function(i){return t.listing.listing_products.splice(n,1)}}},[e("q-tooltip",[t._v("\n              Eliminar Producto\n            ")])],1)],1)])}),e("tr",[e("td",{staticClass:"text-center",attrs:{colspan:"5"}},[e("q-btn",{staticClass:"q-ma-sm",attrs:{icon:"mdi-plus",color:"primary",flat:""},on:{click:function(i){return t.listing.listing_products.push({product:null,lifetime:null,price:"",quantity:""})}}},[t._v("Aggregar Producto")])],1)])],2)]),e("q-separator"),e("div",{staticClass:"row justify-around q-pa-md"},[e("q-btn",{attrs:{color:"secondary",flat:"",type:"reset"}},[t._v("reset")]),e("q-btn",{attrs:{color:"primary",type:"submit"}},[t._v("crear")])],1),e("q-inner-loading",{attrs:{showing:t.loading}},[e("q-spinner")],1)],1)},c=[],m=e("02fa"),p=e.n(m),f=(e("7f7f"),e("c5f6"),e("4917"),e("f3e3")),h=e.n(f),g={name:"CreateListing",data:function(){return{loading:!1,options:{lifetime:[],product:[]},listing:{name:"",available_from:null,available_to:null,supply:"",listing_products:[{product:null,lifetime:null,price:"",quantity:""}]}}},computed:{uploadHeaders:function(){return[{name:"Authorization",value:"Bearer ".concat(this.$store.state.credentials.token)}]},uploadUrl:function(){return"http://localhost:3000/upload/listing/image/".concat(this.listing_id)}},methods:{getPriceAsNumber:function(t){if(""===t)return 0;var i=t.match(/(\d+)\.?(\d)?(\d)?/),e=h()(i,4),n=e[1],s=void 0===n?0:n,a=e[2],l=void 0===a?0:a,o=e[3],r=void 0===o?0:o;return 100*Number(s)+10*Number(l)+Number(r)},reset:function(){this.listing.name="",this.listing.available_from=null,this.listing.available_to=null,this.listing.supply=null,this.listing.listing_products=[{product:null,lifetime:null,price:"",quantity:""}]},submit:function(){this.$q.dialog({title:"Confirmar",message:"Este registro no puede modificicarse luego de la creacion",persistent:!0,cancel:!0}).onOk(this.createListing)},createListing:function(){var t=r()(l.a.mark(function t(){var i,e,n,s,a,o,r,d=this;return l.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(0!==this.listing.listing_products.length){t.next=3;break}return this.$q.notify({icon:"mdi-alert",color:"warning",message:"Debe incluir por lo menos un producto"}),t.abrupt("return");case 3:return i="mutation ($objects: [webstore_listing_insert_input!]!) {\n        insert: insert_webstore_listing (objects: $objects) {\n          affected_rows\n          listings: returning {\n            id: listing_id\n            name\n          }\n        }\n      }",e={objects:p()({},this.listing,{supply:this.listing.supply?Number(this.listing.supply):null,listing_products:{data:this.listing.listing_products.map(function(t){var i=t.product,e=t.lifetime,n=t.price,s=t.quantity;return{quantity:Number(s),price:d.getPriceAsNumber(n),lifetime_id:e.value,product_id:i.value}})}})},t.prev=5,this.loading=!0,t.next=9,this.$gql(i,e,{role:"administrator"});case 9:n=t.sent,s=h()(n.insert.listings,1),a=s[0],o=a.id,r=a.name,this.$q.notify({icon:"mdi-check",color:"positive",message:"Paquete ".concat(r," Creado Exitosamente")}),this.$router.push("/listing/".concat(o)),t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](5),this.$gql.handleError(t.t0);case 21:return t.prev=21,this.loading=!1,t.finish(21);case 24:case"end":return t.stop()}},t,this,[[5,18,21,24]])}));function i(){return t.apply(this,arguments)}return i}(),loadOptions:function(){var t=r()(l.a.mark(function t(){var i,e,n,s,a;return l.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i="query {\n        lifetime: calendar_lifetime {\n          value: lifetime_id\n          label: name\n        }\n        product: webstore_product {\n          value: product_id\n          label: name\n        }\n      }",e={},t.prev=2,this.loading=!0,t.next=6,this.$gql(i,e,{role:"administrator"});case 6:n=t.sent,s=n.lifetime,a=n.product,this.options.lifetime=s,this.options.product=a,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](2),this.$gql.handleError(t.t0);case 16:return t.prev=16,this.loading=!1,t.finish(16);case 19:case"end":return t.stop()}},t,this,[[2,13,16,19]])}));function i(){return t.apply(this,arguments)}return i}()},mounted:function(){this.loadOptions()}},b=g,v=e("2877"),q=Object(v["a"])(b,u,c,!1,null,null,null),_=q.exports,y={name:"Listings",components:{DialogWindow:d["a"],CreateListing:_},data:function(){return{showCreateListingDialog:!1,listings:[],loading:!1}},methods:{refreshData:function(){var t=r()(l.a.mark(function t(){var i,e,n,s;return l.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i="query {\n        data: store_listing (order_by: { created_at: desc }) {\n          listing_id\n          private_name\n          public_name\n          description\n        }\n      }",e={},t.prev=2,this.loading=!1,t.next=6,this.$gql(i,e,{role:"administrator"});case 6:n=t.sent,s=n.data,this.listings=s,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](2),this.$gql.handleError(t.t0);case 14:return t.prev=14,this.loading=!1,t.finish(14);case 17:case"end":return t.stop()}},t,this,[[2,11,14,17]])}));function i(){return t.apply(this,arguments)}return i}()},mounted:function(){this.refreshData()}},x=y,w=Object(v["a"])(x,n,s,!1,null,null,null);i["default"]=w.exports},"7eb4":function(t,i,e){"use strict";var n=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("q-dialog",{attrs:{value:t.value,maximized:t.maximized&&!t.minimized.state,persistent:"",seamless:t.minimized.state,position:t.minimized.state?"bottom":"standard","content-class":t.minimized.state?"dialog-window-minimized q-pa-none":null,"transition-hide":t.minimized.state?"slide-down":"scale"},on:{input:t.update,hide:t.reset}},[t.minimized.state?e("q-bar",{staticClass:"bg-primary text-white cursor-pointer rounded-borders overflow-hidden ellipsis",style:"width: 250px; margin-left: "+250*(null===t.minimized.slot?0:t.minimized.slot)+"px;",on:{click:t.restore}},[e("div",{staticClass:"ellipsis"},[t._v("\n      "+t._s(t.title)+"\n    ")]),e("q-space"),e("q-btn-group",{attrs:{flat:""}},[e("q-btn",{staticClass:"window-minimize",attrs:{flat:"",icon:"mdi-window-minimize",dense:"",disable:t.minimized.state}}),e("q-btn",{attrs:{flat:"",dense:"",icon:"mdi-window-"+(t.maximized?"maximize":"restore")}}),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",dense:"",icon:"mdi-close"},on:{click:function(t){t.stopPropagation(),t.preventDefault()}}})],1)],1):[e("div",{staticClass:"bg-white",style:t.maximized?"":"max-width: none; min-width: 560px"},[e("q-bar",{staticClass:"bg-primary text-white"},[e("div",{staticClass:"ellipsis"},[t._v("\n          "+t._s(t.title)+"\n        ")]),e("q-space"),e("q-btn",{staticClass:"window-minimize",attrs:{flat:"",dense:"",icon:"mdi-window-minimize"},on:{click:t.minimize}}),e("q-btn",{attrs:{flat:"",dense:"",icon:"mdi-window-"+(t.maximized?"restore":"maximize")},on:{click:t.toggle}}),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",dense:"",icon:"mdi-close"}})],1),e("main",{staticClass:"scroll",style:t.maximized?"max-height: calc(100vh - 32px);":"max-height: calc(100vh - 80px);"},[t._t("default")],2)],1)]],2)},s=[],a=(e("6762"),e("2fdb"),e("4db1")),l=e.n(a),o={name:"DialogWindow",props:{title:{type:String,default:""},value:{type:Boolean,required:!0}},data:function(){return{minimized:{state:!1,slots:[],slot:null},maximized:!1}},computed:{toggleIcon:function(){return this.minimized.state?this.maximized?"maximize":"restore":this.maximized?"restore":"maximize"},nextSlot:function(){var t=this;return Math.min.apply(Math,l()(this.minimized.slots.map(function(t,i){return i}).filter(function(i){return!t.minimized.slots.includes(i)})).concat([this.minimized.slots.length]))}},methods:{unbindSlot:function(){this.$root.$emit("DIALOG_WINDOW_RESTORED",this.minimized.slot),this.minimized.slot=null},bindSlot:function(){this.minimized.slot=this.nextSlot,this.$root.$emit("DIALOG_WINDOW_MINIMIZED",this.minimized.slot)},onBindSlot:function(t){this.minimized.slots.push(t)},onUnbindSlot:function(t){this.minimized.slots=this.minimized.slots.filter(function(i){return i!==t})},reset:function(){this.maximized=!1,this.minimizedId=0,null!==this.minimized.slot&&this.unbindSlot(),this.minimized.state=!1},minimize:function(){this.bindSlot(),this.minimized.state=!0},restore:function(){this.minimized.state=!1,this.unbindSlot()},toggle:function(){this.minimized.state?this.restore():this.maximized=!this.maximized},update:function(t){this.$emit("input",t)}},created:function(){this.$root.$on("DIALOG_WINDOW_MINIMIZED",this.onBindSlot),this.$root.$on("DIALOG_WINDOW_RESTORED",this.onUnbindSlot)},beforeDestroy:function(){null!==this.minimized.slot&&this.unbindSlot(),this.$root.$off("DIALOG_WINDOW_MINIMIZED",this.onBindSlot),this.$root.$off("DIALOG_WINDOW_RESTORED",this.onUnbindSlot)}},r=o,d=(e("5fa6"),e("2877")),u=Object(d["a"])(r,n,s,!1,null,null,null);i["a"]=u.exports},e916:function(t,i,e){i=t.exports=e("24fb")(!1),i.push([t.i,".q-btn.window-minimize .q-icon:before{margin-top:45%;height:45%}.q-dialog.dialog-window-minimized>.q-dialog__inner{justify-content:left}",""])}}]);