(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0de181"],{"83d4":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{attrs:{padding:""}},[n("q-table",{attrs:{flat:"",title:e.client?"Uso de productos: "+e.client.name:"Uso de productos",data:e.table.data,columns:e.table.columns,"row-key":"purchased_product_use_id",pagination:e.table.pagination,filter:e.table.filter,loading:e.table.loading,"rows-per-page-options":e.table.rowsPerPageOptions},on:{"update:pagination":function(t){return e.$set(e.table,"pagination",t)},request:e.loadPurchasedProductUse},scopedSlots:e._u([{key:"top-right",fn:function(){return[n("q-input",{attrs:{borderless:"",dense:"",debounce:"300",placeholder:"Buscar"},scopedSlots:e._u([{key:"append",fn:function(){return[n("q-icon",{attrs:{name:"mdi-magnify"}})]},proxy:!0}]),model:{value:e.table.filter,callback:function(t){e.$set(e.table,"filter",t)},expression:"table.filter"}})]},proxy:!0},{key:"body-cell-cancel",fn:function(t){return[n("q-td",{attrs:{props:t,"auto-width":""}},[t.row.cancelled?e._e():n("q-btn",{attrs:{disable:t.row.cancelled,label:"Cancelar",size:"sm",dense:"",color:"negative",outline:""},on:{click:function(n){return e.cancelPurchasedProductUse(t.row.purchased_product_use_id)}}})],1)]}}])}),n("q-inner-loading",{attrs:{showing:e.loading}},[n("q-spinner")],1)],1)},a=[],i=n("02fa"),o=n.n(i),c=n("967e"),l=n.n(c),u=(n("96cf"),n("fa84")),d=n.n(u),s=(n("7f7f"),n("bd4c")),p=s["b"].formatDate,_={name:"PurchasedProductUse",props:{clientId:{type:String,required:!1}},data:function(){return{loading:!1,client:null,table:{loading:!1,data:[],columns:[{name:"client_name",label:"Cliente",align:"left",field:function(e){return e.purchased_product.client.name},format:function(e,t){return e}},{name:"product_private_name",label:"Producto",align:"left",field:function(e){return e.purchased_product.product.public_name},format:function(e,t){return e}},{name:"created_at",label:"Creado",align:"left",field:function(e){return e.created_at},format:function(e,t){return p(e,"YYYY/MM/DD HH:mm")}},{name:"created_by_user",label:"Creado Por",align:"left",field:function(e){return e.created_by_user.username},format:function(e,t){return e}},{name:"cancelled",label:"Cancellado",align:"left",field:function(e){return e.cancelled},format:function(e,t){return e?"Si":"No"}},{name:"cancelled_motive",label:"Motivo",align:"left",field:function(e){return e.cancelled_motive},format:function(e,t){return e}},{name:"updated_at",label:"Actualizado",align:"left",field:function(e){return e.updated_at},format:function(e,t){return p(e,"YYYY/MM/DD HH:mm")}},{name:"updated_by_user",label:"Actualizado por",align:"left",field:function(e){return e.updated_by_user.username},format:function(e,t){return e}},{name:"cancel",label:"Cancelar"}],rowsPerPageOptions:[3,4,6,8,9,12,15,16,18,20,24],pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:6,rowsNumber:0},filter:""}}},methods:{cancelPurchasedProductUse:function(e){var t=this;this.$q.dialog({title:"Cancelar uso de producto",message:'Esta accion es irreversible. Una vez anulado el uso, el producto podra ser utilizado de nuevo. Para continuar, ingrese el motivo de la cancelacion y aprete "OK"',prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(function(){var n=d()(l.a.mark(function n(r){var a,i,o,c;return l.a.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(r){n.next=3;break}return t.$q.notify({color:"warning",icon:"mdi-alert",message:"Debe ingresar un motivo para cancelar el uso"}),n.abrupt("return");case 3:return a="mutation ($where: store_purchased_product_use_bool_exp! $_set: store_purchased_product_use_set_input) {\n          updated: update_store_purchased_product_use (where: $where _set: $_set) {\n            count: affected_rows\n          }\n        }",i={where:{purchased_product_use_id:{_eq:e}},_set:{cancelled_motive:r}},n.prev=5,t.loading=!0,n.next=9,t.$gql(a,i,{role:"administrator"});case 9:o=n.sent,c=o.updated.count,t.$q.notify({color:"positive",icon:"mdi-check",message:"".concat(c," uso de producto cancellado")}),n.next=17;break;case 14:n.prev=14,n.t0=n["catch"](5),t.$gql.handleError(n.t0);case 17:return n.prev=17,t.loading=!1,t.loadPurchasedProductUse(),n.finish(17);case 21:case"end":return n.stop()}},n,null,[[5,14,17,21]])}));return function(e){return n.apply(this,arguments)}}())},loadPurchasedProductUse:function(){var e=d()(l.a.mark(function e(){var t,n,r,a,i,c,u,d,s,p=arguments;return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=p.length>0&&void 0!==p[0]?p[0]:{},n=t.pagination,r=t.filter,a=void 0===r?"":r,n||(n=this.table.pagination),i="query ($where: store_purchased_product_use_bool_exp! $offset: Int! $limit: Int! $order_by: [store_purchased_product_use_order_by!]) {\n        meta: store_purchased_product_use_aggregate (where: $where) {\n          rows: aggregate {\n            count\n          }\n        }\n        data: store_purchased_product_use (where: $where offset: $offset limit: $limit order_by: $order_by) {\n          purchased_product_use_id\n          created_at\n          created_by_user {\n            user_id\n            username\n          }\n          cancelled\n          cancelled_motive\n          updated_at\n          updated_by_user {\n            user_id\n            username\n          }\n          purchased_product {\n            client {\n              name\n            }\n            purchased_product_id\n            product {\n              private_name\n              public_name\n              description\n            }\n            lifetime {\n              start\n              end\n            }\n          }\n        }\n      }",c={limit:n.rowsPerPage,offset:n.rowsPerPage*(n.page-1),order_by:[{created_at:"desc"},{updated_at:"desc"}],where:{purchased_product:{client_id:this.clientId?{_eq:this.clientId}:null,_or:a?[{product:{private_name:{_ilike:"%".concat(a,"%")}}},{product:{public_name:{_ilike:"%".concat(a,"%")}}},{product:{description:{_ilike:"%".concat(a,"%")}}},{client:{name:{_ilike:"%".concat(a,"%")}}}]:[{}]}}},e.prev=4,this.table.loading=!0,e.next=8,this.$gql(i,c,{role:"administrator"});case 8:u=e.sent,d=u.data,s=u.meta.rows.count,this.table.pagination=o()({},n,{rowsNumber:s}),this.table.data=d,e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](4),this.$gql.handleError(e.t0);case 18:return e.prev=18,this.table.loading=!1,e.finish(18);case 21:case"end":return e.stop()}},e,this,[[4,15,18,21]])}));function t(){return e.apply(this,arguments)}return t}(),loadClient:function(){var e=d()(l.a.mark(function e(){var t,n,r,a;return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.clientId){e.next=2;break}return e.abrupt("return");case 2:return t="query ($client_id: uuid!) {\n        client: store_client_by_pk (client_id: $client_id) {\n          client_id\n          name\n        }\n      }",n={client_id:this.clientId},e.prev=4,this.loading=!0,e.next=8,this.$gql(t,n,{role:"administrator"});case 8:r=e.sent,a=r.client,this.client=a,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](4),this.$gql.handleError(e.t0);case 16:return e.prev=16,this.loading=!1,e.finish(16);case 19:case"end":return e.stop()}},e,this,[[4,13,16,19]])}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){this.loadClient(),this.loadPurchasedProductUse()}},f=_,h=n("2877"),m=Object(h["a"])(f,r,a,!1,null,null,null);t["default"]=m.exports}}]);