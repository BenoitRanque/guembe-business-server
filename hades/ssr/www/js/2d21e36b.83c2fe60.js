(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d21e36b"],{d537:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-page",{attrs:{padding:""}},[n("q-stepper",{ref:"stepper",attrs:{flat:"",vertical:"",color:"primary",animated:""},model:{value:t.step,callback:function(e){t.step=e},expression:"step"}},[n("q-step",{attrs:{name:0,title:"Iniciar"}},[t._v("\n      Bienvenido al procedimiento de checkout. Aprete Siguiente para continuar\n      "),n("q-stepper-navigation",{attrs:{align:"right"}},[n("q-btn",{attrs:{color:"primary",label:"Empezar"},on:{click:function(e){t.step++}}})],1)],1),n("q-step",{attrs:{name:1,title:"Compra"}},[t._v("\n      Por favor valide los detalles de su compra que se presentan aqui:\n      "),n("shopping-cart"),n("q-stepper-navigation",{staticClass:"q-gutter-x-md",attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",color:"primary",label:"Volver"},on:{click:function(e){t.step--}}}),n("q-btn",{attrs:{color:"primary",disable:!t.$store.state.cart.listings.length,label:"Siguiente"},on:{click:function(e){t.step++}}})],1)],1),n("q-step",{attrs:{name:2,title:"Facturacion"}},[t._v("\n      Datos de facturacion (opcional si no required factura con NIT)\n      "),n("q-select",{attrs:{loading:t.loading,options:t.clients,label:"NIT & Razon Social"},scopedSlots:t._u([{key:"append",fn:function(){return[n("create-client",{attrs:{icon:"mdi-account-plus",flat:"",dense:""},on:{done:t.clientCreated}},[n("q-tooltip",[t._v("Aggregar Cliente Nuevo")])],1)]},proxy:!0}]),model:{value:t.client,callback:function(e){t.client=e},expression:"client"}}),n("q-stepper-navigation",{staticClass:"q-gutter-x-md",attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",color:"primary",label:"Volver"},on:{click:function(e){t.step--}}}),n("q-btn",{attrs:{color:"primary",label:t.client?"Siguiente":"Omitir"},on:{click:function(e){t.step++}}})],1)],1),n("q-step",{attrs:{name:3,title:"Finalizar"}},[t._v("\n      finish\n      "),n("q-stepper-navigation",{staticClass:"q-gutter-x-md",attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",color:"primary",label:"Volver"},on:{click:function(e){t.step--}}}),n("q-btn",{attrs:{color:"primary",label:"Finalizar"},on:{click:t.checkout}})],1)],1)],1)],1)},a=[],r=n("967e"),s=n.n(r),l=(n("96cf"),n("fa84")),c=n.n(l),o=n("02fa"),u=n.n(o),p=n("c6c8"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("q-btn",t._b({on:{click:function(e){e.stopPropagation(),t.showDialog=!0}}},"q-btn",t.$attrs,!1),[t._t("default"),n("q-dialog",{attrs:{persistent:t.loading},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[n("q-card",[n("q-bar",[t._v("\n        Crear Cliente\n        "),n("q-space"),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",dense:"",icon:"mdi-close",disable:t.loading}})],1),n("q-form",{staticClass:"q-gutter-y-md q-pa-md",on:{submit:t.submit}},[n("q-input",{attrs:{type:"number",placeholder:"0",required:"",label:"NIT",square:"",outlined:""},model:{value:t.client.tax_identification_number,callback:function(e){t.$set(t.client,"tax_identification_number",e)},expression:"client.tax_identification_number"}}),n("q-input",{attrs:{placeholder:"SIN NOMBRE",required:"",label:"RAZON SOCIAL",square:"",outlined:""},model:{value:t.client.business_name,callback:function(e){t.$set(t.client,"business_name",e)},expression:"client.business_name"}}),n("q-btn",{attrs:{type:"submit",color:"accent"}},[t._v("Crear")]),n("q-inner-loading",{attrs:{showing:t.loading}},[n("q-spinner")],1)],1)],1)],1)],2)},m=[],h=n("f3e3"),f=n.n(h),b={name:"CreateClient",data:function(){return{loading:!1,showDialog:!1,client:{business_name:"",tax_identification_number:""}}},methods:{reset:function(){this.client.business_name="",this.client.tax_identification_number=""},submit:function(){var t=c()(s.a.mark(function t(){var e,n,i,a,r;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e="mutation ($objects: [account_client_insert_input!]!) {\n        insert: insert_account_client (objects: $objects) {\n          clients: returning {\n            client_id\n            business_name\n            tax_identification_number\n          }\n        }\n      }",n={objects:{business_name:this.client.business_name,tax_identification_number:this.client.tax_identification_number}},t.prev=2,this.loading=!0,t.next=6,this.$gql(e,n);case 6:i=t.sent,a=f()(i.insert.clients,1),r=a[0],this.showDialog=!1,this.reset(),this.$emit("done",r),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](2),this.$gql.handleError(t.t0);case 17:return t.prev=17,this.loading=!1,t.finish(17);case 20:case"end":return t.stop()}},t,this,[[2,14,17,20]])}));function e(){return t.apply(this,arguments)}return e}()}},_=b,g=n("2877"),q=Object(g["a"])(_,d,m,!1,null,null,null),v=q.exports,x={name:"Checkout",components:{ShoppingCart:p["a"],CreateClient:v},data:function(){return{step:0,loading:!1,client:null,clients:[]}},methods:{mapClientOption:function(t){var e=t.client_id,n=t.business_name,i=t.tax_identification_number;return u()({},t,{value:e,label:[i,n].join(", ")})},clientCreated:function(t){this.client=this.mapClientOption(t),this.loadClients()},loadClients:function(){var t=c()(s.a.mark(function t(){var e,n,i;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e="query {\n        clients: account_client {\n          client_id\n          business_name\n          tax_identification_number\n        }\n      }",t.prev=1,this.loading=!0,t.next=5,this.$gql(e);case 5:n=t.sent,i=n.clients,this.clients=i.map(this.mapClientOption),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),this.$gql.handleError(t.t0);case 13:return t.prev=13,this.loading=!1,t.finish(13);case 16:case"end":return t.stop()}},t,this,[[1,10,13,16]])}));function e(){return t.apply(this,arguments)}return e}(),checkout:function(){var t=c()(s.a.mark(function t(){var e,n,i,a;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.loading=!0,t.next=4,this.$api.post("/store/checkout",{client_id:this.client?this.client.client_id:null});case 4:e=t.sent,n=e.data.sale_payment.payment,i=n.khipu_app_url,a=n.khipu_payment_url,window.location.href=this.$q.platform.is.mobile?i:a,t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](0),this.$api.handleError(t.t0);case 14:return t.prev=14,this.loading=!1,t.finish(14);case 17:case"end":return t.stop()}},t,this,[[0,11,14,17]])}));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){this.loadClients()}},k=x,w=Object(g["a"])(k,i,a,!1,null,null,null);e["default"]=w.exports}}]);